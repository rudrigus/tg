%TCIDATA{LaTeXparent=0,0,relatorio.tex}
                      
\chapter{Resultados Experimentais}\label{CapExperimentos}

% Resumo opcional. Comentar se não usar.
%\resumodocapitulo{Resumo opcional.}

\section{Introdução}

Na introdução deverá ser feita uma descrição geral dos experimentos realizados. 

Para cada experimentação apresentada, descrever as condições de experimentação (e.g., instrumentos, ligações específicas, configurações dos programas), os resultados obtidos na forma de tabelas, curvas ou gráficos. Por fim, tão importante quando ter os resultados é a análise que se faz deles. Quando os resultados obtidos não forem como esperados, procurar justificar e/ou propor alteração na teoria de forma a justificá-los.

Foram realizadas simulações nas duas etapas do projeto. As duas utilizaram imagens antigas do trabalho \cite{luciano}, como mencionado anteriormente. As simulações ocorreram também durante a formulação do algoritmo e contribuíram para as escolhas de parâmetros e filtros utilizados.



\section{Avaliação do algoritmo em Matlab}


As imagens utilizadas para validar o algoritmo são provenientes do trabalho \cite{luciano}. Cada uma tem 296x264 \textit{pixels} em níveis de cinza.

As seções \ref{section:result-filtros} a \ref{section:result-correcao-distorcao} utilizam três imagens para demonstrar a sequência do algoritmo, passo a passo. Essas são as de número 440 a 442, em uma filmagem denominada ''Resultados Filtro Adaptativo'' e foram capturadas a uma taxa de 1000 FPS. 

\subsection{Seleção de imagens}

Para a validação desta etapa são utilizadas as imagens de número 2000 a 2999
da filmagem não sincronizada denominada ''Resultados 2 DVd Guilherme'', a 1000 FPS. 
Algumas dessas imagens estão em sequência na figura \ref{fig:desenv-imagens-selecao}.
A figura \ref{fig:result-selecao-imagens} Mostra quais imagens foram selecionadas para se fazer o processamento. O fator de brilho utilizado para esta sequência de imagens é de 20\%.


\begin{figure}[h!]
\includegraphics[width=\textwidth]{./Figuras/result-grafico-selecao-02.jpg}
\caption{Imagens selecionadas com fator brilho de 20\%}
\label{fig:result-selecao-imagens}
\end{figure}

\subsection{Filtros}\label{section:result-filtros}

Esta seção faz uma comparação de imagens com e sem os filtros selecionados. As imagens foram escolhidas propositalmente para a apresentação destes resultados de forma a ressaltar a importância de cada filtro. Todas as imagens desta seção têm as informações relevantes apresentadas por meio de linhas coloridas. Essas linhas são:

\begin{itemize}
\item Azul horizontal: topo e base do eletrodo de solda;
\item Amarelo tracejado vertical: bordas da poça de soldagem
\item Vermelho: posições da lateral esquerda do eletrodo;
\item Verde: posições da lateral direita do eletrodo;
\item Azul oblíquo(quase vertical): reta calculada por regressão das laterais do eletrodo.
\end{itemize}

\subsubsection{Média de imagens}
A primeira etapa do algoritmo é o filtro de média de imagens, como descrito na seção \ref{section:desenv-filtros}. A figura \ref{fig:result-media-imagens} demonstra as diferenças entre se fazer ou não a média de imagens para a obtenção das medidas. É possível observar na figura \ref{fig:result-media-imagens-1} que há algo preso ao eletrodo de soldagem e que o algoritmo de identificação de bordas está considerando isso como uma borda do eletrodo na figura \ref{fig:result-media-imagens-2}, mas não na figura na figura \ref{fig:result-media-imagens-3}.

\begin{figure}[h!]
\subfigure[\label{fig:result-media-imagens-2}]{
	\centering
	\includegraphics[width=.5\textwidth]{./Figuras/imagem440-medidas.jpg}}
\subfigure[\label{fig:result-media-imagens-3}]{
	\centering
	\includegraphics[width=.5\textwidth]{./Figuras/imagem440-442-medidas.jpg}}
\caption{(a) Resultado sem média de imagens. (b) Resultado com média de imagens}.
\label{fig:result-media-imagens}
\end{figure}

É importante ressaltar que esta comparação foi feita utilizando os outros filtros e métodos de medição definidos para o projeto. A figura \ref{fig:result-media-imagens-sem-filtro} demonstra como a média não proporciona resultados satisfatórios por si só.

\begin{figure}[h!]
\subfigure[\label{fig:result-media-imagens-sem-filtro-1}]{
	\centering
	\includegraphics[width=.5\textwidth]{./Figuras/imagem440-medidas.jpg}}
\subfigure[\label{fig:result-media-imagens-sem-filtro-2}]{
	\centering
	\includegraphics[width=.5\textwidth]{./Figuras/imagem440-442-medidas-sem-filtros.jpg}}
\caption{(a) Resultado sem média de imagens. (b) Resultado com média sem filtros}

\label{fig:result-media-imagens-sem-filtro}
\end{figure}

\subsubsection{Primeira binarização}\label{section:result-threshold1}

Em seguida é feito o primeiro filtro de binarização. A imagem \ref{fig:detalhe-scanlines} demonstra de forma satisfatória o resultado deste filtro. Como a ocorrência das \textit{scanlines} sua utilização antes ou depois do filtro de médias tem o mesmo efeito.  Visualmente, o efeito desse filtro é tão pequeno que cogitou-se retirá-lo, mas o custo computacional é tão baixo que decidiu-se mantê-lo. A figura \ref{fig:result-threshold1} ilustra qual é o efeito das \textit{scanlines} sobre a imagem. A primeira binarização tem evita medidas erradas nas bordas do eletrodo decorrentes das \textit{scanlines}.

\begin{figure}[h!]
\begin{center}
\subfigure[\label{fig:result-threshold1-1}]{
	\centering
	\includegraphics[width=.45\textwidth]{./Figuras/imagem440-comum-zoom.jpg}}
\subfigure[\label{fig:result-threshold1-2}]{
	\centering
	\includegraphics[width=.45\textwidth]{./Figuras/imagem440-threshold1-zoom.jpg}}
\end{center}
\caption{(a) Detalhe de imagem com \textit{scanlines} e (b) sem \textit{scanlines}}
\label{fig:result-threshold1}
\end{figure}


\subsubsection{Filtro de gaussiana}

O filtro seguinte, de máscara gaussiana, tem o efeito de atenuar bordas e pequenos ruídos aleatórios na imagem. A figura \ref{fig:result-filtro-gaussiana} demonstra a utilização deste filtro após a primeira binarização.

\begin{figure}[h!]
\subfigure[\label{fig:result-filtro-gaussiana-1}]{
	\centering
	\includegraphics[width=.5\textwidth]{./Figuras/imagem440-442-medidas-sem-filtro-gaussiana.jpg}}
\subfigure[\label{fig:result-filtro-gaussiana-2}]{
	\centering
	\includegraphics[width=.5\textwidth]{./Figuras/imagem440-442-medidas.jpg}}
\caption{(a) Imagem original e (b) depois de filtro de gaussiana}
\label{fig:result-filtro-gaussiana}
\end{figure}

Visualmente, o filtro parece quase não afetar a imagem, mas os ruídos neste exemplo têm grande impacto no cálculo do perfil vertical e consequentemente em sua derivada.


\subsubsection{Segunda binarização}

Em seguida é aplicada a segunda binarização que visa eliminar porções e ruídos pouco relevantes ao processamento. Esta etapa faz duas binarizações, uma por mínimo e uma por máximo, e não apenas uma. Mas por serem operações simples e independentes de ordem chamou-se apenas de ''segunda binarização''.

A maior diferença é evidente na porção inferior da imagem, que é mais brilhosa na figura \ref{fig:result-medidas-threshold23-1}. Essa diferença de brilhosidade pode afetar o funcionamento dos algoritmos de perfis e suas derivadas.

A figura \ref{fig:result-medidas-threshold23} mostra o efeito sobre as imagens 440 a 442, sobre a identificação da borda da poça. Outras imagens têm melhorias mais significativas com este filtro.

\begin{figure}[h!]
\subfigure[\label{fig:result-medidas-threshold23-1}]{
	\centering
	\includegraphics[width=.5\textwidth]{./Figuras/imagem440-442-medidas-sem-threshold23.jpg}}
\subfigure[\label{fig:result-medidas-threshold23-2}]{
	\centering
	\includegraphics[width=.5\textwidth]{./Figuras/imagem440-442-medidas.jpg}}
\caption{(a) Imagem sem a segunda binarização e (b) com segunda binarização}
\label{fig:result-medidas-threshold23}
\end{figure}


\subsection{Perfis Horizontais e Verticais}

Depois da passagem dos filtros, as medidas são feitas com as derivadas dos perfis vertical e horizontal. As figuras \ref{fig:result-perfil-hor} e \ref{fig:result-perfil-vert} mostram essas derivadas e a posição obtida em cada mínimo ou máximo local. Cada uma dessas posições resulta em uma medida, que no caso dessas imagens são apresentadas na tabela \ref{table:medidas-440-442}

\begin{figure}[h!]
\subfigure[\label{fig:result-perfil-hor}]{
	\centering
		\includegraphics[width=.5\textwidth]{./Figuras/imagem440-442-perfil-hor.jpg}}
\subfigure[\label{fig:result-perfil-vert}]{
	\centering
	\includegraphics[width=.5\textwidth]{./Figuras/imagem440-442-perfil-vert.jpg}}
\caption{(a) Perfil horizontal. (b) Perfil vertical.}
\end{figure}

\begin{table}[h!]
\centering
\begin{tabular}{|l|c|}
\hline
\textbf{Parâmetro} & \textbf{Valor} \\ \hline
Limite esquerdo da poça & 41 \\ \hline
Limite direito da poça & 257 \\ \hline
Topo do eletrodo & 49 \\ \hline
Base do eletrodo & 190 \\ \hline
\end{tabular}
\label{table:medidas-440-442}
\caption{Medidas obtidas com derivadas de perfis horizontal e vertical.}
\end{table}
 

\subsection{Bordas do eletrodo e regressão robusta}

Para o eletrodo, o mesmo princípio é utilizado, porém com derivadas \textit{pixel} a \textit{pixel}. Essas derivadas são mostradas na figura \ref{fig:result-derivadas-arame}. As posições encontradas são armazenadas em um vetor para a regressão. Os vetores obtidos com as imagens são podem ser avaliados na tabela \ref{table:bordas-arame}

\begin{figure}[h!]
\centering
\includegraphics[width=.7\textwidth]{./Figuras/imagem440-442-bordas-arame.jpg}
\caption{Bordas do arame detectadas por derivadas}
\label{fig:result-derivadas-arame}
\end{figure}

\begin{table}[h!]
\centering
\begin{tabular}{|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|}
\hline
\textbf{Esquerda} & 144 & 143 & 143 & 143 & 142 & 142 & 141 & 141 & 141 & 140 & 140 & 139 & 139 & 139 & 141 & 140 \\ \hline
\textbf{Direita} & 177 & 176 & 176 & 175 & 174 & 174 & 173 & 173 & 172 & 172 & 171 & 171 & 170 & 169 & 169 & 168  \\ \hline
\end{tabular}
\label{table:bordas-arame}
\caption{Valores encontrados para bordas do arame com 16 pontos observados.}
\end{table}


Os vetores são utilizados para uma regressão robusta que define as equações de reta das laterais do arame. Essas retas já foram mostradas em figuras anteriores como a \ref{fig:result-medidas-threshold23-2}. Os valores dos coeficientes de das retas obtidas com as repressões são apresentados na tabela \ref{table:coef-arame}.

\begin{table}[h!]
\centering
\begin{tabular}{|c|c|c|}
\hline
 & \textbf{a} & \textbf{b} \\ \hline
\textbf{Esquerda} & -0.0430 & 145,9618 \\ \hline
\textbf{Direita} & -0.0626 & 179,9779 \\ \hline
\end{tabular}
\label{table:coef-arame}
\caption{Coeficientes da regressão nos pontos das bordas do eletrodo.}
\end{table}

Esses valores são utilizados para se encontrar os vértices do eletrodo demonstrados na tabela \ref{table:vertices-arame}. As retas de regressão são ilustradas na figura \ref{fig:result-regressao}

\begin{table}[h!]
\centering
\begin{tabular}{|c|c|c|}
\hline
 & \textbf{X} & \textbf{Y} \\ \hline
\textbf{Topo esquerdo} & 143,8552 & 49 \\ \hline
\textbf{Base esquerdo} & 137,7931 & 190 \\ \hline
\textbf{Topo direito} & 176,9117 & 49 \\ \hline
\textbf{Base direito} & 168,0883 & 190 \\ \hline
\end{tabular}
\label{table:vertices-arame}
\caption{Coeficientes da regressão nos pontos das bordas do eletrodo.}
\end{table}

\begin{figure}[h!]
\centering
\includegraphics[width=.7\textwidth]{./Figuras/imagem440-442-bordas-arame-regressao.jpg}
\caption{Bordas do arame detectadas por derivadas}
\label{fig:result-regressao}
\end{figure}


\subsection{Correção da distorção de perspectiva e medidas}\label{section:result-correcao-distorcao}

Para encontrar os valores finais com a correção de distorção de perspectiva, todos os passos anteriores foram aplicados em imagens corrigidas. No exemplo mostrado, utilizou-se uma imagem base como padrão para se definir os parâmetros da distorção, a imagem número 181 da mesma série. A figura \ref{fig:result-imagem-corrigida-medidas} mostra uma imagem transformada e tratada pelos filtros com as posições dos valores buscados. 

\begin{figure}[h!]
\centering
\includegraphics[width=.6\textwidth]{./Figuras/imagem440-442-corrigida-medidas.jpg}
\caption{Bordas do arame detectadas por derivadas}
\label{fig:result-imagem-corrigida-medidas}
\end{figure}


Os valores podem ser vistos na tabela \ref{table:result-imagem-corrigida} com a unidade em \textit{pixels}. Os valores reais, em mm, estão na tabela\ref{table:result-imagem-corrigida-mm}.

\begin{table}[h!]
\centering
\begin{tabular}{|l|c|c|}
\hline
 & \textbf{X} & \textbf{Y} \\ \hline
\textbf{Limite esquerdo da poça} & 185 &  \\ \hline
\textbf{Limite direito da poça} & 857 & \\ \hline
\textbf{Topo esquerdo} & 464.8906 & 288 \\ \hline
\textbf{Base esquerdo} & 468.0658 & 1223 \\ \hline
\textbf{Topo direito} & 563.0091 & 288 \\ \hline
\textbf{Base direito} & 565.9742 & 1223 \\ \hline
\end{tabular}
\label{table:result-imagem-corrigida}
\caption{Valores medidos com o algoritmo em uma imagem corrigida.}
\end{table}

\begin{table}[h!]
\centering
\begin{tabular}{|l|c|c|}
\hline
 & \textbf{X} & \textbf{Y} \\ \hline
\textbf{Limite esquerdo da poça} & 1,8895 &  \\ \hline
\textbf{Limite direito da poça} & 8,7531 & \\ \hline
\textbf{Topo esquerdo} & 4,7482 & 2,9415 \\ \hline
\textbf{Base esquerdo} & 4,7806 & 12,4913 \\ \hline
\textbf{Topo direito} & 5,7504 & 2,9415 \\ \hline
\textbf{Base direito} & 5,7806 & 12,4913 \\ \hline
\end{tabular}
\label{table:result-imagem-corrigida-mm}
\caption{Valores reais medidos com o algoritmo em uma imagem corrigida.}
\end{table}

Esses valores são bastante razoáveis, considerando-se que uma imagem da mesma série foi utilizada para se fazer a calibração. Pode-se ver por exemplo que a largura calculada do eletrodo vai de $5,7806 - 4,7806 = 1mm$ no topo a $ 5,7504 - 4,7482 = 1,0022mm$ na base. Esses valores são bastante razoáveis e demonstram que a transformação está ocorrendo de forma satisfatória.

A largura da poça neste grupo de imagens é $8,7531 - 1,8895 = 6,8636mm$, um valor bastante plausível para uma solda de 1mm sobre uma chapa única.

A altura do eletrodo, $12,4913 - 2,9415 = 9,5498mm$, apresenta um valor consideravelmente menor que o esperado de 10,25mm. Este valor pode significar uma variação no comprimento do eletrodo enquanto esse se funde durante o processo.

\subsection{Resultados com sequência de imagens}

O algoritmo foi aplicado em uma sequência de imagens, das quais se obtiveram as medidas desejadas. Foram utilizadas as imagens de número 150 a 480. As sequências de medidas podem ser vistas nos gráficos de \ref{fig:result-bordas-poca} a \ref{fig:result-medidas-arame}.
Essas medidas foram todas calculadas em mm. Os pontos em branco são referentes a imagens com brilho excessivo que não foram processadas.

\begin{figure}[h!]
\centering
\includegraphics[width=.8\textwidth]{./Figuras/imagem150-480-bordas-poca.jpg}
\caption{Bordas da poça ao longo do tempo}
\label{fig:result-bordas-poca}
\end{figure}

Pode-se observar na figura \ref{fig:result-bordas-poca} que para a sequência testada a largura da poça de soldagem teve pouca variação, sendo a borda esquerda bastante estável durante todo o período. A borda direita apresentou algumas mais variações. Há dois pontos discrepantes no gráfico, que devem significar uma falha no algoritmo.

\begin{figure}[h!]
\centering
\includegraphics[width=.8\textwidth]{./Figuras/imagem150-480-altura-eletrodo.jpg}
\caption{Altura do eletrodo ao longo do tempo}
\label{fig:result-altura-eletrodo}
\end{figure}

De acordo com a figura \ref{fig:result-altura-eletrodo} o eletrodo de soldagem esteve boa parte do tempo entre 9mm e 11mm de comprimento. A variação desse comprimento aparentemente não tem uma frequência padrão que possa ser analisada. Apenas poucos pontos indicam alguma falha do algoritmo neste quesito por estarem muito afastados do valor médio.

\begin{figure}[h!]
\centering
\includegraphics[width=.8\textwidth]{./Figuras/imagem150-480-medidas-arame.jpg}
\caption{Posição do eletrodo ao longo do tempo}
\label{fig:result-medidas-arame}	
\end{figure}

A figura \ref{fig:result-medidas-arame} mostra a variação de posição horizontal do topo e da base do eletrodo. Salvo por dois pontos discrepantes, a variação destes valores não é muito grande.

Foi feito um gráfico extra com as medidas da poça comparadas com a posição do eletrodo. Este gráfico, na figura \ref{fig:result-bordas-poca-medidas-arame}, deixa claro que as medidas de borda direita da poça e de posição do eletrodo devem ter alguma correlação.

\begin{figure}[h!]
\centering
\includegraphics[width=.8\textwidth]{./Figuras/imagem150-480-bordas-poca-medidas-arame.jpg}
\caption{Posição do eletrodo e bordas da poça ao longo do tempo}
\label{fig:result-bordas-poca-medidas-arame}
\end{figure}

%O gráfico \ref{fig:result-grafico-bordas-poca} foi sobreposto a um cordão de solda para se verificar a qualidade do algoritmo. Essa comparação se segue na figura \ref{fig:result-comparacao-bordas}

O mesmo procedimento foi feito com uma sequência de imagens não sincronizadas. Foram utilizadas as imagens de número 2000 a 5452
da filmagem não sincronizada denominada ''Resultados 2 DVd Guilherme'', a 1000 FPS. As figuras \ref{fig:result-altura-eletrodo-ns} e \ref{fig:result-bordas-poca-medidas-arame-ns} apresentam os resultados com essas imagens.

\begin{figure}[h!]
\centering
\includegraphics[width=.8\textwidth]{./Figuras/imagem2000-5452-altura-eletrodo.jpg}
\caption{Altura do eletrodo ao longo do tempo}
\label{fig:result-altura-eletrodo-ns}
\end{figure}


\begin{figure}[h!]
\centering
\includegraphics[width=.8\textwidth]{./Figuras/imagem2000-5452-bordas-poca-medidas-arame.jpg}
\caption{Posição do eletrodo e bordas da poça ao longo do tempo}
\label{fig:result-bordas-poca-medidas-arame-ns}
\end{figure}

Os pontos de maior falha no gráfico \ref{fig:result-bordas-poca-medidas-arame-ns} foram avaliados. Tratam-se das imagens 4727 e 4743. As medidas foram marcadas nessas imagens e apresentadas na figura \ref{fig:result-falhas}.


\begin{figure}[h!]
\begin{center}
\subfigure[\label{fig:result-falhas-1}]{
	\centering
		\includegraphics[width=.4\textwidth]{./Figuras/imagem4720-4727-falha.jpg}}
\subfigure[\label{fig:result-falhas-2}]{
	\centering
	\includegraphics[width=.4\textwidth]{./Figuras/imagem4726-4743-falha.jpg}}
\caption{(a) Imagens 4720 a 4727. (b) Imagens 4726 a 4743.}
\end{center}
\label{fig:result-falhas}
\end{figure}

Como pode-se observar, essas imagens ter brilho especificamente muito baixo, o que comprometeu o algoritmo de reconhecimento das bordas do eletrodo.


\section{Avaliação do algoritmo em FPGA}

O projeto em FPGA foi também simulado com imagens anteriores do trabalho \cite{luciano}, porém as simulações foram feitas como descrito na seção \ref{section:desenv-simulacoes-fpga} com arquivos. Para que pudessem ser comportadas 4 imagens em memória, que tem o tamanho máximo de 65536 \textit{bytes}, as simulações utilizadas para o foram feitas com imagens reduzidas, de 128x128 \textit{pixels}.
Nesta seção serão apresentados resultados do processamento com imagens no tamanho original.
Os valores aqui obtidos são comparados com aqueles da simulação em Matlab.
Não foram geradas imagens com as medidas nestas simulações, apenas as formas de onda geradas pelo \textit{software} Modelsim são avaliadas.

\subsection{Filtros}

\subsubsection{Primeira binarização}

Como citado na seção \ref{section:result-threshold1}, este filtro pode ser utilizado antes da média de imagens, o que é feito neste caso. Para verificar que está funcionando, basta comparar a forma de onda dos \textit{pixels} antes e depois deste filtro. As regiões mais escuras das imagens da imagem, com valores baixos de brilhosidade, devem aparecer com valor respectivo zero após o filtro. Esse comportamento pode ser visto na figura \ref{fig:result-fpga-threshold1} com a comparação entre $pixelz\_entrada$ e $pixel\_filtrado0$.

\begin{figure}[h!]
\centering
\includegraphics[width=\textwidth]{./Figuras/fpga-imagem440-threshold1.png}
\caption{Formas de onda de \textit{pixels} antes e depois da primeira binarização.}
\label{fig:result-fpga-threshold1}
\end{figure}

\subsubsection{Filtro de gaussiana}

Abaixo é mostrada uma parte do arquivo de imagem, com valores hexadecimais onde está localizada a janela para o filtro. Esta parte começa na linha 70 e coluna 48 da imagem número 440. O pixel filtrado é o da linha 71 e coluna 49, e o novo pixel é o da linha 72, coluna 50.

\begin{table}[h!]
\centering
\begin{tabular}{|c|c|c|c|c|c|c|c|c|c|}
\hline
... & \cellcolor{yellow} 48 & \cellcolor{yellow} 4A & \cellcolor{yellow} 52 & 53 & 55 & 57 & 59 & 54 & ... \\ \hline
... & \cellcolor{yellow} 4C & \cellcolor{yellow} 51 & \cellcolor{yellow} 52 & 51 & 58 & 58 & 5D & 58 & ... \\ \hline
... & \cellcolor{yellow} 4E & \cellcolor{yellow} 53 & \cellcolor{yellow} 55 & & & & & & \\ \hline
\end{tabular}
\label{table:result-porcao-imagem-buffer}
\caption{Porção da imagem para filtro de gaussiana.}
\end{table}

O resultado da simulação pode ser visto na figura \ref{fig:result-porcao-imagem-buffer}. Os índices da variável $janela\_p\_filtro$, que aparecem em ordem inversa, confirmam o armazenamento do \textit{buffer}. É importante lembrar que os índices em VHDL começam do zero, portanto a variável $linha=71$ na imagem representa a linha 72 e a $coluna=49$, a coluna 50. 

\begin{figure}[h!]
\centering
\includegraphics[width=.6\textwidth]{./Figuras/fpga-imagem440-result-porcao-imagem-buffer.png}
\caption{Formas de onda de \textit{pixels} na janela para filtro de gaussiana.}
\label{fig:result-porcao-imagem-buffer}
\end{figure}

O resultado do cálculo, pode ser visto na variável $pixel\_filtrado1=4F$ (79 em decimal) muito próximo do que seria o resultado se fosse utilizado ponto flutuante: 80,1424. Vale também notar que o $pixel\_filtrado1$ tem um atraso devido ao filtro.

\subsubsection{Segunda binarização}

Esse filtro pode ser visualizado da mesma forma que a primeira binarização. A figura \ref{fig:result-fpga-threshold23} mostra a binarização seguida nas variáveis $pixel\_filtrado2$ e $pixel\_filtrado3$. Os limiares utilizados foram $threshold2=26$ (1A) e $threshold2=127$ (7F).

\begin{figure}[h!]
\centering
\includegraphics[width=\textwidth]{./Figuras/fpga-imagem440-threshold23.png}
\caption{Formas de onda de \textit{pixels} antes e depois da segunda binarização.}
\label{fig:result-fpga-threshold23}
\end{figure}

\subsubsection{Média de imagens}

Esse filtro deve fornecer o somatório de três \textit{pixels} de mesma linha e coluna nas três imagens utilizadas, apenas para as imagens com brilho total menor que o máximo definido.

Como explicado nas seções \ref{section:topo-base} e  \ref{section:desenv-bordas-poca-fpga} esses valores são calculados a cada \textit{pixel} recebido nos vetores $somaHor$ e $somaVert$
A figura \ref{fig:result-fpga-media-imagens} mostra a saída com a soma dos \textit{pixels} armazenados em memória. 

\begin{figure}[h!]
\centering
\includegraphics[width=.6\textwidth]{./Figuras/fpga-imagem440-443media.png}
\caption{Atualização de valores a cada novo pixel.}
\label{fig:result-fpga-media-imagens}
\end{figure}

Pode-se ver que o índice 49 do vetor $somaHor$ é acrescido do valor hexadecimal $3D-33=A$ (10 em decimal) pois $369C-3692=A$. 

O mesmo ocorre para o índice 48 do vetor $somaVert$, com $7047-703D=A$.

Esses valores sofrem a subtração apenas à partir da quarta imagem, pois como demonstrado a figura \ref{fig:result-fpga-q}, $q$ é zero durante as três primeiras.

\begin{figure}[h!]
\centering
\includegraphics[width=.9\textwidth]{./Figuras/fpga-imagem440-443-q.png}
\caption{Valor lido da memória ao longo das quatro primeiras imagens.}
\label{fig:result-fpga-q}
\end{figure}

\subsection{Seleção de imagens propícias}

Por praticidade decidiu-se utilizar as mesmas imagens e apenas se alterar o valor de $brilho\_maximo$ durante as simulações. A figura \ref{fig:result-fpga-selecao} mostra o avanço de $bloco\_atual$ e consequentemente o avanço dos blocos de memória para valores diferentes de $brilhoMaximo$.

\subsection{Perfis horizontais e perfis verticais}

Aqui são de fato apresentadas as medidas que deseja obter com o sistema.

A figura \ref{fig:result-fpga-medidas-arame-poca-440-442} apresenta os resultados que são melhor organizados na tabela \ref{table:result-fpga-medidas-arame-poca}.

\begin{figure}[h!]
\centering
\includegraphics[width=.9\textwidth]{./Figuras/fpga-imagem440-442-medidas-arame-poca.png}
\caption{Medidas do arame e poça ao longo das três primeiras imagens.}
\label{fig:result-fpga-medidas-arame-poca-440-442}
\end{figure}

Para melhor visualizar os resultados ao final da imagem, a figura \ref{fig:result-fpga-medidas-arame-poca-440-442-det} mostra com mais detalhes esses valores antes de serem atualizados no processamento da próxima imagem.

\begin{figure}[h!]
\centering
\includegraphics[width=.7\textwidth]{./Figuras/fpga-imagem440-442-medidas-arame-poca-det.png}
\caption{Medidas do arame e poça ao final da terceira imagens.}
\label{fig:result-fpga-medidas-arame-poca-440-442-det}
\end{figure}

A tabela \ref{table:result-fpga-medidas-arame-poca} lista os valores calculados na primeira coluna, comparando-os aos valores que seriam equivalentes se a imagem fosse do tamanho original de 296x264 \textit{pixels} e às medidas encontradas com o aloritmo em Matlab

\begin{table}[h!]
\centering
\begin{tabular}{|c|c|c|}
\hline
\textbf{Calculado} & \textbf{Equivalente} & \textbf{Matlab} \\ \hline
19 & 43,9375 & 41 \\ \hline
111 & 256,6875 & 257 \\ \hline
24 & 49,5 & 49 \\ \hline
93 & 191,8125 & 190 \\ \hline
\end{tabular}
\label{table:result-fpga-medidas-arame-poca}
\caption{Valores medidos.}
\end{table}

\subsection{Regressão linear}

Esta etapa do projeto chegou a ser concluída, mas aqui serão apresentados os resultados intermediários do algoritmo de regressão linear.

A tabela \ref{table:result-bordas-arame} lista os pontos encontrados para se fazer a regressão.

A tabela \ref{table:fpga-coeficientes-regressao} apresenta os valores calculados para os coeficientes de reta em seu estágio intermediário.
